<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>3Dç‚«å…‰ä¸Šå¤´å°çƒ Â· æœ€ç»ˆç¨³å®šç‰ˆ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;
    -webkit-tap-highlight-color: transparent !important;
    -webkit-focus-ring-color: transparent !important;
    outline: none !important;
    -webkit-user-select: none;
    user-select: none;
}
html,body{
    width:100%;
    height:100%;
    background:#000;
    overflow:hidden;
    font-family:Arial, sans-serif;
    cursor:pointer;
}
.menu{
    position:fixed;
    top:0;left:0;
    width:100vw;
    height:100vh;
    background:radial-gradient(circle at center,#101025 0%,#000 80%);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:9999;
    color:#fff;
    padding:20px;
}
.menu h1{
    font-size: clamp(32px, 8vw, 52px);
    color:#0ff;
    text-shadow:0 0 20px #0ff;
    margin-bottom: clamp(20px, 5vh, 40px);
    text-align:center;
}
.menu h2{
    font-size: clamp(24px, 6vw, 38px);
    color:#0ff;
    text-shadow:0 0 15px #0ff;
    margin-bottom: clamp(15px, 4vh, 30px);
    text-align:center;
}
.menu-btn{
    width: min(90%, 300px);
    padding: clamp(12px, 3vh, 18px) 0;
    margin: clamp(6px, 2vh, 12px) 0;
    font-size: clamp(16px, 4vw, 22px);
    font-weight:bold;
    border:none;
    border-radius:12px;
    cursor:pointer;
    transition:all 0.2s;
    text-align:center;
    background:none;
}
.menu-btn.primary{
    background:#0ff;
    color:#000;
    box-shadow:0 0 20px #0ff;
}
.menu-btn.secondary{
    background:#ff2266;
    color:#fff;
    box-shadow:0 0 20px #ff2266;
}
.menu-btn.tertiary{
    background:#8844ff;
    color:#fff;
    box-shadow:0 0 20px #8844ff;
}
.menu-btn.gold{
    background:#ffd700;
    color:#000;
    box-shadow:0 0 20px #ffd700;
}
.menu-btn.ai{
    background:#00ff88;
    color:#000;
    box-shadow:0 0 20px #00ff88;
}
.menu-btn.dev{
    background:#ff0066;
    color:#fff;
    box-shadow:0 0 20px #ff0066;
}
.menu-btn:hover{transform:scale(1.03)}
.menu-btn:active{transform:scale(0.97);background:none;}
.menu-btn:disabled{
    background:#333;
    box-shadow:none;
    opacity:0.5;
    cursor:not-allowed;
    transform:none;
}
.gold-display{
    position:absolute;
    top:2vh;
    right:3vw;
    font-size: clamp(18px, 4vw, 26px);
    font-weight:bold;
    color:#ffd700;
    text-shadow:0 0 10px #ffd700;
    cursor:pointer;
    text-align:right;
}
.score-display{
    position:absolute;
    top:7vh;
    right:3vw;
    font-size: clamp(16px, 3.5vw, 22px);
    font-weight:bold;
    color:#0ff;
    text-shadow:0 0 10px #0ff;
    text-align:right;
}
.back-btn{
    position:absolute;
    top:2vh;
    left:3vw;
    padding: clamp(6px, 1.5vh, 10px) clamp(12px, 3vw, 20px);
    background:#333;
    color:#fff;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size: clamp(14px, 3vw, 18px);
}
.back-btn:hover{background:#555}

#settingsBtn{
    position:absolute;
    bottom:3vh;
    left:50%;
    transform:translateX(-50%);
    width: clamp(45px, 10vw, 55px);
    height: clamp(45px, 10vw, 55px);
    background:rgba(255,255,255,0.1);
    border:2px solid #0ff;
    border-radius:50%;
    color:#0ff;
    font-size: clamp(20px, 5vw, 26px);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:10000;
}
#settingsBtn:hover{
    background:rgba(255,255,255,0.2);
    box-shadow:0 0 15px #0ff;
}

/* è®¾ç½®é¢æ¿å·¦ä¸Šè§’å°é»‘ç‚¹ */
#devDot{
    position:absolute;
    top:12px;
    left:12px;
    width:10px;
    height:10px;
    background:#000;
    border-radius:50%;
    cursor:pointer;
    z-index:999999;
}

.toast{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:rgba(0,0,0,0.95);
    padding: clamp(10px, 2vh, 15px) clamp(20px, 4vw, 30px);
    border-radius:10px;
    border:2px solid #ffd700;
    color:#fff;
    font-size: clamp(14px, 3.5vw, 18px);
    z-index:99999;
    display:none;
    white-space:nowrap;
}

/* AIå¯¹è¯ å…¨å±ç•Œé¢ */
#aiChatPanel{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    background:radial-gradient(circle at center,#101025 0%,#000 80%);
    z-index:99999;
    display:none;
    flex-direction:column;
    padding:20px;
    color:#fff;
}
#aiChatPanel h3{
    color:#00ff88;
    text-align:center;
    margin:10px 0 20px 0;
    font-size: clamp(20px, 5vw, 28px);
}
.chat-box{
    flex:1;
    overflow-y:auto;
    background:rgba(255,255,255,0.05);
    border-radius:12px;
    padding:15px;
    margin-bottom:15px;
    display:flex;
    flex-direction:column;
    gap:12px;
}
.chat-message{
    max-width:85%;
    padding:10px 14px;
    border-radius:14px;
    font-size: clamp(15px, 3.5vw, 17px);
    line-height:1.4;
}
.user-msg{
    align-self:flex-end;
    background:#0ff;
    color:#000;
}
.ai-msg{
    align-self:flex-start;
    background:#8844ff;
    color:#fff;
}
.chat-input-box{
    display:flex;
    gap:10px;
    margin-bottom:10px;
}
#chatInput{
    flex:1;
    padding:14px;
    border:2px solid #00ff88;
    border-radius:10px;
    background:#000;
    color:#fff;
    outline:none;
    font-size: clamp(15px, 3.5vw, 17px);
}
#sendChatBtn{
    padding:14px 18px;
    background:#00ff88;
    color:#000;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
    font-size: clamp(15px, 3.5vw, 17px);
}
#aiChatPanel .back-btn{
    position:unset;
    align-self:center;
    width:min(90%,200px);
    text-align:center;
}

.skin-list{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: clamp(10px, 3vw, 20px);
    margin: clamp(15px, 4vh, 30px) 0;
    width:min(95%,380px);
    justify-content:center;
}
.skin-item{
    padding: clamp(10px, 2vh, 15px);
    background:rgba(255,255,255,0.1);
    border-radius:12px;
    text-align:center;
    border:2px solid transparent;
    display:flex;
    flex-direction:column;
    align-items:center;
}
.skin-item.active{
    border-color:#0ff;
    box-shadow:0 0 15px #0ff;
}
.skin-preview{
    width: clamp(50px, 12vw, 65px);
    height: clamp(50px, 12vw, 65px);
    border-radius:50%;
    margin:0 auto clamp(6px, 1.5vh, 10px);
}
.skin-name{
    font-size: clamp(12px, 2.5vw, 14px);
    margin-bottom: clamp(4px, 1vh, 8px);
}
.skin-btn{
    width:100%;
    padding: clamp(4px, 1vh, 6px) 0;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size: clamp(10px, 2vw, 12px);
    font-weight:bold;
    background:#333;
}
.skin-btn:disabled{
    background:#333;
    opacity:0.6;
    cursor:not-allowed;
}

.exchange-box{
    width:min(95%,340px);
    background:rgba(255,255,255,0.1);
    padding: clamp(20px, 4vh, 30px);
    border-radius:15px;
    border:2px solid #ffd700;
    text-align:center;
    margin:clamp(10px, 3vh, 20px) 0;
}
.exchange-rule{
    font-size: clamp(14px, 3.5vw, 18px);
    margin-bottom: clamp(10px, 2vh, 20px);
    color:#ffd700;
}
.exchange-input-box{
    display:flex;
    align-items:center;
    justify-content:center;
    gap: clamp(6px, 2vw, 10px);
    margin: clamp(10px, 2vh, 20px) 0;
}
.exchange-input{
    width:min(60%,160px);
    padding: clamp(8px, 2vh, 12px);
    font-size: clamp(14px, 3.5vw, 18px);
    border:2px solid #ffd700;
    border-radius:8px;
    background:#000;
    color:#fff;
    text-align:center;
    outline:none;
}
.exchange-input:focus{
    box-shadow:0 0 15px #ffd700;
}
.exchange-count{
    font-size: clamp(13px, 3vw, 16px);
    margin: clamp(5px, 1vh, 10px) 0;
    color:#fff;
}

.item-box{
    width:min(95%,340px);
    background:rgba(255,255,255,0.1);
    padding: clamp(20px, 4vh, 30px);
    border-radius:15px;
    border:2px solid #ffd700;
    text-align:center;
    margin:clamp(10px, 3vh, 20px) 0;
}
.item-title{
    font-size: clamp(16px, 4vw, 20px);
    color:#ffd700;
    margin-bottom:15px;
}
.item-row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:10px 0;
    border-bottom:1px solid #333;
}
.item-desc{
    font-size:clamp(14px,3.5vw,16px);
    color:#fff;
}
.item-price{
    font-size:clamp(14px,3.5vw,16px);
    color:#ffd700;
    font-weight:bold;
}

#settingsPanel{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:#111;
    border:3px solid #0ff;
    padding: clamp(20px, 4vh, 30px);
    border-radius:15px;
    z-index:99999;
    display:none;
    text-align:center;
    width:min(90%,340px);
}
#settingsPanel h3{
    color:#0ff;
    margin-bottom: clamp(10px, 2vh, 20px);
    font-size: clamp(18px, 4.5vw, 24px);
}
.setting-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin: clamp(8px, 2vh, 15px) 0;
    padding: clamp(6px, 1.5vh, 10px);
    background:rgba(255,255,255,0.05);
    border-radius:8px;
}
.setting-label{
    font-size: clamp(14px, 3.5vw, 16px);
    color:#fff;
}
.switch{
    position:relative;
    width: clamp(45px, 10vw, 50px);
    height: clamp(22px, 5vw, 24px);
    background:#333;
    border-radius:12px;
    cursor:pointer;
    transition:background 0.3s;
}
.switch.active{
    background:#0ff;
}
.switch::after{
    content:'';
    position:absolute;
    width: clamp(18px, 4vw, 20px);
    height: clamp(18px, 4vw, 20px);
    background:#fff;
    border-radius:50%;
    top:2px;
    left:2px;
    transition:all 0.3s;
}
.switch.active::after{
    left:calc(100% - clamp(18px, 4vw, 20px) - 2px);
}
.danger-btn{
    width:100%;
    padding: clamp(8px, 2vh, 12px);
    margin-top:clamp(10px, 3vh, 20px);
    background:#ff2266;
    color:#fff;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
    font-size: clamp(14px, 3.5vw, 16px);
}
.danger-btn:hover{
    background:#ff0044;
}

/* è¶…çº§å¼€å‘è€…é¢æ¿ï¼ˆè®¾ç½®å°é»‘ç‚¹è¿›å…¥ï¼‰ */
#superDevPanel{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:#111;
    border:3px solid #ff0066;
    padding:20px;
    border-radius:15px;
    z-index:999999;
    display:none;
    text-align:center;
    width:min(95%,360px);
    color:#fff;
}
#superDevPanel h3{
    color:#ff0066;
    margin-bottom:15px;
    font-size: clamp(18px,4.5vw,24px);
}
.dev-input{
    width:80%;
    padding:8px;
    margin:6px 0;
    border-radius:6px;
    border:1px solid #ff0066;
    background:#000;
    color:#fff;
    text-align:center;
}
.dev-row{
    margin:8px 0;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:0 10px;
}
.dev-btn{
    padding:8px 12px;
    margin:4px;
    background:#ff0066;
    color:#fff;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:14px;
}

#gameUI{display:none}
#game{
    width:100vw;
    height:100vh;
    position:relative;
    perspective:1200px;
    background:radial-gradient(circle at center,#101020 0%,#000 80%);
}
#score{
    position:fixed;
    top:2vh;
    left:50%;
    transform:translateX(-50%);
    font-size: clamp(40px, 10vw, 55px);
    font-weight:bold;
    color:#0ff;
    text-shadow:0 0 15px #0ff;
    z-index:99;
}
#pauseBtn{
    position:fixed;
    top:2vh;
    left:3vw;
    width: clamp(40px, 9vw, 48px);
    height: clamp(40px, 9vw, 48px);
    background:rgba(255,255,255,0.2);
    border:2px solid #fff;
    border-radius:8px;
    color:#fff;
    font-size: clamp(16px, 4vw, 20px);
    cursor:pointer;
    z-index:100;
    display:flex;
    align-items:center;
    justify-content:center;
}
.item-use-box{
    position:fixed;
    bottom:4vh;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:clamp(15px,4vw,25px);
    z-index:100;
}
.item-use-btn{
    width:clamp(60px,15vw,80px);
    height:clamp(40px,10vw,50px);
    background:rgba(255,215,0,0.2);
    border:2px solid #ffd700;
    border-radius:8px;
    color:#ffd700;
    font-size:clamp(12px,3vw,14px);
    font-weight:bold;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    pointer-events:auto;
}
.item-use-btn.disabled{
    opacity:0.5;
    cursor:not-allowed;
}
.item-use-text{
    line-height:1.2;
}

#player{
    width: clamp(32px, 8vw, 40px);
    height: clamp(32px, 8vw, 40px);
    border-radius:50%;
    position:absolute;
    z-index:100;
    transform:translate(-50%,-50%);
}
.trail{
    position:absolute;
    width: clamp(10px, 2.5vw, 14px);
    height: clamp(10px, 2.5vw, 14px);
    border-radius:50%;
    pointer-events:none;
    opacity:0.7;
    z-index:50;
}
.obstacle{
    position:absolute;
    background:linear-gradient(90deg,#ff2266,#ff8800);
    height: clamp(20px, 5vh, 26px);
    box-shadow:0 0 20px #ff2266;
    border-radius:6px;
    z-index:10;
}

.modal{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:rgba(0,0,0,0.9);
    padding: clamp(25px, 5vh, 40px);
    border-radius:20px;
    border:3px solid #0ff;
    text-align:center;
    z-index:1000;
    display:none;
    width:min(90%,320px);
}
.modal h2{
    font-size: clamp(24px, 6vw, 36px);
    margin-bottom: clamp(10px, 2vh, 20px);
}
.modal p{
    font-size: clamp(16px, 4vw, 20px);
    margin-bottom: clamp(5px, 1vh, 10px);
}
.modal .menu-btn{
    width:min(100%,200px);
    margin:clamp(6px, 1.5vh, 8px) 0;
}

@keyframes shake{
    0%{transform:translate(0,0)}
    25%{transform:translate(-6px,4px)}
    50%{transform:translate(4px,-3px)}
    75%{transform:translate(-3px,-5px)}
    100%{transform:translate(0,0)}
}
.shake{animation:shake 0.1s 4}
@keyframes pulse{
    0%{box-shadow:0 0 25px var(--skin-color),0 0 50px var(--skin-color2)}
    50%{box-shadow:0 0 40px var(--skin-color),0 0 80px var(--skin-color2)}
    100%{box-shadow:0 0 25px var(--skin-color),0 0 50px var(--skin-color2)}
}
.pulse{animation:pulse 0.4s infinite}
@keyframes toastShow{
    0%{opacity:0;transform:translate(-50%,-50%) scale(0.8)}
    50%{opacity=1;transform:translate(-50%,-50%) scale(1.05)}
    100%{opacity=1;transform:translate(-50%,-50%) scale(1)}
}
.toast.show{
    display:block;
    animation:toastShow 0.3s ease;
}
</style>
</head>
<body>

<!-- ä¸»èœå• -->
<div id="mainMenu" class="menu">
    <h1>3Dç‚«å…‰ä¸Šå¤´å°çƒ</h1>
    <button class="menu-btn primary" onclick="showDifficultyMenu()">å¼€å§‹æ¸¸æˆ</button>
    <button class="menu-btn ai" onclick="showAIChat()">AIå¯¹è¯ï¼ˆ5é‡‘å¸/æ¬¡ï¼‰</button>
    <button class="menu-btn gold" onclick="showExchangeMenu()">é‡‘å¸å…‘æ¢</button>
    <button class="menu-btn tertiary" onclick="showSkinMenu()">çš®è‚¤å…‘æ¢</button>
    <button class="menu-btn gold" onclick="showItemMenu()">é“å…·è´­ä¹°</button>
    
    <div class="gold-display">é‡‘å¸: <span id="mainGold">0</span></div>
    <div class="score-display">ç´¯è®¡å¾—åˆ†: <span id="mainScore">0</span></div>
    <div id="settingsBtn" onclick="showSettingsPanel()">âš™ï¸</div>
</div>

<!-- AIå¯¹è¯é¢æ¿ -->
<div id="aiChatPanel">
    <h3>AIå¯¹è¯ Â· æ¯æ¬¡æé—®æ‰£5é‡‘å¸</h3>
    <div class="chat-box" id="chatBox"></div>
    <div class="chat-input-box">
        <input type="text" id="chatInput" placeholder="è¾“å…¥ä½ æƒ³é—®çš„é—®é¢˜...">
        <button id="sendChatBtn" onclick="sendChat();event.stopPropagation()">å‘é€</button>
    </div>
    <button class="back-btn" onclick="hideAIChat()">è¿”å›</button>
</div>

<!-- éš¾åº¦é€‰æ‹© -->
<div id="difficultyMenu" class="menu" style="display:none">
    <h1>é€‰æ‹©éš¾åº¦</h1>
    <button class="menu-btn primary" onclick="startGame('easy')">ç®€å•æ¨¡å¼</button>
    <button class="menu-btn secondary" onclick="startGame('normal')">æ™®é€šæ¨¡å¼</button>
    <button class="menu-btn tertiary" onclick="startGame('hard')">å›°éš¾æ¨¡å¼</button>
    <button class="back-btn" onclick="showMainMenu()">è¿”å›</button>
    <div class="gold-display">é‡‘å¸: <span id="diffGold">0</span></div>
    <div class="score-display">ç´¯è®¡å¾—åˆ†: <span id="diffScore">0</span></div>
</div>

<!-- é‡‘å¸å…‘æ¢ -->
<div id="exchangeMenu" class="menu" style="display:none">
    <h2>é‡‘å¸å…‘æ¢</h2>
    <button class="back-btn" onclick="showMainMenu()">è¿”å›</button>
    <div class="gold-display">é‡‘å¸: <span id="exchangeGold">0</span></div>
    <div class="score-display">ç´¯è®¡å¾—åˆ†: <span id="exchangeScore">0</span></div>
    
    <div class="exchange-box">
        <p class="exchange-rule">å…‘æ¢è§„åˆ™ï¼š5ä¸ªç´¯è®¡å¾—åˆ† = 1ä¸ªé‡‘å¸</p>
        <div class="exchange-count">å½“å‰å¯å…‘æ¢æœ€å¤§é‡‘å¸æ•°ï¼š<span id="maxExchange">0</span></div>
        <div class="exchange-input-box">
            <input type="number" class="exchange-input" id="exchangeNum" min="1" value="1">
            <span>ä¸ª</span>
        </div>
        <div class="exchange-count">éœ€æ¶ˆè€—å¾—åˆ†ï¼š<span id="needScore">5</span></div>
        <button class="menu-btn gold" onclick="exchangeGold()">ç¡®è®¤å…‘æ¢</button>
        <button class="menu-btn primary" onclick="exchangeMax()">ä¸€é”®å…‘æ¢æœ€å¤§</button>
    </div>
</div>

<!-- çš®è‚¤å…‘æ¢ -->
<div id="skinMenu" class="menu" style="display:none">
    <h1>çš®è‚¤å…‘æ¢</h1>
    <div class="gold-display" id="skinGoldDisplay">é‡‘å¸: <span id="skinGold">0</span></div>
    <button class="back-btn" onclick="showMainMenu()">è¿”å›</button>
    <div class="skin-list" id="skinList"></div>
</div>

<!-- é“å…·è´­ä¹°èœå• -->
<div id="itemMenu" class="menu" style="display:none">
    <h1>é“å…·è´­ä¹°</h1>
    <button class="back-btn" onclick="showMainMenu()">è¿”å›</button>
    <div class="gold-display">é‡‘å¸: <span id="itemGold">0</span></div>
    
    <div class="item-box">
        <div class="item-title">æ¶ˆè€—é‡‘å¸è´­ä¹°é“å…·</div>
        <div class="item-row">
            <div class="item-desc">æŠ¤ç›¾ï¼ˆæŠµæŒ¡ç¢°æ’ï¼‰</div>
            <div class="item-price">30é‡‘å¸/ä¸ª</div>
            <button class="menu-btn gold" style="padding:6px 12px;font-size:14px" onclick="buyItem('shield')">è´­ä¹°</button>
        </div>
        <div class="item-row">
            <div class="item-desc">åŒå€å¾—åˆ†ï¼ˆ10ç§’Ã—2ï¼‰</div>
            <div class="item-price">50é‡‘å¸/ä¸ª</div>
            <button class="menu-btn gold" style="padding:6px 12px;font-size:14px" onclick="buyItem('double')">è´­ä¹°</button>
        </div>
    </div>
</div>

<!-- è®¾ç½®é¢æ¿ + å·¦ä¸Šè§’å°é»‘ç‚¹ -->
<div id="settingsPanel">
    <div id="devDot"></div> <!-- åŒå‡»å°é»‘ç‚¹è¿›å…¥å¼€å‘è€… -->
    <h3>æ¸¸æˆè®¾ç½®</h3>
    <div class="setting-item">
        <span class="setting-label">ç‰¹æ•ˆå¼€å…³</span>
        <div class="switch" id="effectSwitch" onclick="toggleEffect()"></div>
    </div>
    <div class="setting-item">
        <span class="setting-label">ç¢°æ’éœ‡åŠ¨</span>
        <div class="switch" id="vibrationSwitch" onclick="toggleVibration()"></div>
    </div>
    <button class="danger-btn" onclick="confirmReset()">æ³¨é”€æ‰€æœ‰è¿›åº¦</button>
    <button class="menu-btn primary" style="margin-top:20px;" onclick="hideSettingsPanel()">è¿”å›</button>
</div>

<!-- è¶…çº§å¼€å‘è€…é¢æ¿ï¼ˆè®¾ç½®å°é»‘ç‚¹è¿›å…¥ï¼‰ -->
<div id="superDevPanel">
    <h3>è¶…çº§å¼€å‘è€…æ§åˆ¶å°</h3>
    <div class="dev-row"><span>ä¿®æ”¹é‡‘å¸</span><input type="number" id="setGoldInput" class="dev-input"></div>
    <div class="dev-row"><span>ä¿®æ”¹æ€»åˆ†</span><input type="number" id="setScoreInput" class="dev-input"></div>
    <div class="dev-row"><span>ä¿®æ”¹æŠ¤ç›¾</span><input type="number" id="setShieldInput" class="dev-input"></div>
    <div class="dev-row"><span>ä¿®æ”¹åŒå€</span><input type="number" id="setDoubleInput" class="dev-input"></div>
    <button class="dev-btn" onclick="setAllData()">ä¸€é”®åº”ç”¨ä¿®æ”¹</button>
    <button class="dev-btn" onclick="forceShowPlayer()">å¼ºåˆ¶æ˜¾ç¤ºå°çƒ</button>
    <button class="dev-btn" onclick="forceGodMode()">å¼ºåˆ¶æ— æ•Œæ¨¡å¼</button>
    <button class="dev-btn" onclick="clearAllObstacle()">æ¸…é™¤æ‰€æœ‰éšœç¢ç‰©</button>
    <button class="dev-btn" onclick="fixAllBug()">ä¸€é”®ä¿®å¤æ‰€æœ‰BUG</button>
    <button class="dev-btn" onclick="forceGameWin()">å¼ºåˆ¶æ¸¸æˆèƒœåˆ©</button>
    <button class="dev-btn" onclick="closeSuperDev()">å…³é—­</button>
</div>

<!-- æ¸¸æˆç•Œé¢ -->
<div id="gameUI">
    <div id="score">0</div>
    <button id="pauseBtn" onclick="showPauseMenu();event.stopPropagation()">ğŸ </button>
    <div class="item-use-box">
        <div id="shieldUseBtn" class="item-use-btn" onclick="useShieldItem();event.stopPropagation()">
            <div class="item-use-text">æŠ¤ç›¾</div>
            <div class="item-use-text" id="shieldNum">0</div>
        </div>
        <div id="doubleUseBtn" class="item-use-btn" onclick="useDoubleItem();event.stopPropagation()">
            <div class="item-use-text">åŒå€</div>
            <div class="item-use-text" id="doubleNum">0</div>
        </div>
    </div>
    <div id="game"></div>
</div>

<!-- æš‚åœ -->
<div id="pauseMenu" class="modal">
    <h2>æ¸¸æˆæš‚åœ</h2>
    <button class="menu-btn primary" onclick="resumeGame()">ç»§ç»­æ¸¸æˆ</button>
    <button class="menu-btn secondary" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
    <button class="menu-btn tertiary" onclick="backToMain()">è¿”å›ä¸»é¡µé¢</button>
</div>

<!-- æ¸¸æˆç»“æŸ -->
<div id="gameOverMenu" class="modal">
    <h2 style="color:#ff2266">æ¸¸æˆç»“æŸ</h2>
    <p>æœ¬å±€å¾—åˆ†: <span id="finalScore">0</span></p>
    <p>ç´¯è®¡æ€»å¾—åˆ†: <span id="totalScoreShow">0</span></p>
    <p>å½“å‰é‡‘å¸: <span id="currentGoldShow">0</span></p>
    <button class="menu-btn primary" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
    <button class="menu-btn tertiary" onclick="backToMain()">è¿”å›ä¸»é¡µé¢</button>
</div>

<!-- æç¤º -->
<div id="toast" class="toast"></div>

<script>
const game = document.getElementById('game');
const scoreText = document.getElementById('score');
const pauseMenu = document.getElementById('pauseMenu');
const gameOverMenu = document.getElementById('gameOverMenu');
const mainMenu = document.getElementById('mainMenu');
const difficultyMenu = document.getElementById('difficultyMenu');
const exchangeMenu = document.getElementById('exchangeMenu');
const skinMenu = document.getElementById('skinMenu');
const itemMenu = document.getElementById('itemMenu');
const gameUI = document.getElementById('gameUI');
const toast = document.getElementById('toast');
const skinGoldDisplay = document.getElementById('skinGoldDisplay');
const settingsPanel = document.getElementById('settingsPanel');
const effectSwitch = document.getElementById('effectSwitch');
const vibrationSwitch = document.getElementById('vibrationSwitch');
const shieldUseBtn = document.getElementById('shieldUseBtn');
const doubleUseBtn = document.getElementById('doubleUseBtn');
const shieldNum = document.getElementById('shieldNum');
const doubleNum = document.getElementById('doubleNum');
const aiChatPanel = document.getElementById('aiChatPanel');
const chatBox = document.getElementById('chatBox');
const chatInput = document.getElementById('chatInput');
const devDot = document.getElementById('devDot');
const superDevPanel = document.getElementById('superDevPanel');

let w = innerWidth, h = innerHeight;
let player, score=0, speed=0, rotateSpeed=0, playing=false;
let obstacles=[], px=w/2, py=h/2, spawnTimer=null, currentDifficulty='normal';
let activeShield = false;
let doubleActive = false;
let doubleTimer = null;
let godMode = false;

let settings = { effectsEnabled:true, vibrationEnabled:true };

const skins = [
    {id:1,name:"æ·±æµ·è“",price:10,color:"#0099ff",color2:"#0ff",owned:true},
    {id:2,name:"çƒˆç„°çº¢",price:20,color:"#ff2266",color2:"#ff8800",owned:false},
    {id:3,name:"æå…‰ç´«",price:30,color:"#8844ff",color2:"#cc00ff",owned:false},
    {id:4,name:"é’è‰ç»¿",price:40,color:"#00ff88",color2:"#00cc66",owned:false},
    {id:5,name:"é»„é‡‘è€€",price:50,color:"#ffd700",color2:"#ffaa00",owned:false},
    {id:6,name:"å¹»å½©ç™½",price:60,color:"#ffffff",color2:"#ddddff",owned:false}
];

let currentSkin = skins.find(s=>s.id===1);

let userData = {
    gold:0, totalScore:0, ownedSkins:[1], currentSkinId:1,
    shield:0, double:0
};

const difficultyConfig = {
    easy:{initSpeed:4,speedGain:0.08,rotateGain:0.1,spawnInterval:800},
    normal:{initSpeed:7,speedGain:0.15,rotateGain:0.2,spawnInterval:500},
    hard:{initSpeed:10,speedGain:0.22,rotateGain:0.35,spawnInterval:350}
};

function safeNumber(n,d=0){let v=Number(n);return isNaN(v)?d:v}

// ====================== è®¾ç½®é¢æ¿å°é»‘ç‚¹ åŒå‡»è¿›å…¥å¼€å‘è€… ======================
devDot.ondblclick = ()=>{
    let pwd = prompt("è¯·è¾“å…¥å¼€å‘è€…å¯†ç ï¼š");
    if(pwd === "33012"){
        hideSettingsPanel();
        superDevPanel.style.display = "block";
        document.getElementById('setGoldInput').value = userData.gold;
        document.getElementById('setScoreInput').value = userData.totalScore;
        document.getElementById('setShieldInput').value = userData.shield;
        document.getElementById('setDoubleInput').value = userData.double;
        showToast("è¶…çº§å¼€å‘è€…æ¨¡å¼å·²å¼€å¯");
    }else if(pwd){
        showToast("å¯†ç é”™è¯¯");
    }
}
function closeSuperDev(){
    superDevPanel.style.display = "none";
}
// è¶…çº§å¼€å‘è€…åŠŸèƒ½
function setAllData(){
    userData.gold = safeNumber(document.getElementById('setGoldInput').value);
    userData.totalScore = safeNumber(document.getElementById('setScoreInput').value);
    userData.shield = safeNumber(document.getElementById('setShieldInput').value);
    userData.double = safeNumber(document.getElementById('setDoubleInput').value);
    saveUserData();
    updateAllDataDisplay();
    showToast("æ•°æ®ä¿®æ”¹æˆåŠŸ");
}
function forceShowPlayer(){
    createPlayer();
    showToast("å¼ºåˆ¶æ˜¾ç¤ºå°çƒæˆåŠŸ");
}
function forceGodMode(){
    godMode = !godMode;
    activeShield = true;
    createPlayer();
    showToast(godMode ? "æ— æ•Œæ¨¡å¼å·²å¼€å¯" : "æ— æ•Œæ¨¡å¼å·²å…³é—­");
}
function clearAllObstacle(){
    obstacles.forEach(o=>o.remove());
    obstacles = [];
    showToast("å·²æ¸…é™¤æ‰€æœ‰éšœç¢ç‰©");
}
function fixAllBug(){
    resetGame();
    createPlayer();
    godMode = false;
    showToast("æ‰€æœ‰BUGå·²ä¸€é”®ä¿®å¤");
}
function forceGameWin(){
    score = 99999;
    scoreText.innerText = score;
    gameOver();
    showToast("å¼ºåˆ¶æ¸¸æˆèƒœåˆ©");
}

// ====================== åŸæœ‰çš®è‚¤åŒå‡»æ”¹é‡‘å¸ å®Œå…¨ä¸åŠ¨ ======================
skinGoldDisplay.ondblclick=()=>{
    if(skinMenu.style.display!=='flex') return;
    let p=prompt("è¾“å…¥å¼€å‘è€…å¯†ç ï¼š");
    if(p==="33012"){
        let v=safeNumber(prompt("è¾“å…¥é‡‘å¸æ•°é‡ï¼š"), userData.gold);
        userData.gold=v;
        saveUserData();
        updateAllDataDisplay();
        renderSkinList();
        updateItemBtnUI();
        showToast(`é‡‘å¸è®¾ä¸ºï¼š${v}`);
    }else if(p) showToast("å¯†ç é”™è¯¯");
}

// é“å…·åŠŸèƒ½
function updateItemBtnUI(){
    shieldNum.innerText = userData.shield;
    doubleNum.innerText = userData.double;
    shieldUseBtn.className = userData.shield>0 ? "item-use-btn" : "item-use-btn disabled";
    doubleUseBtn.className = userData.double>0 ? "item-use-btn" : "item-use-btn disabled";
}
function useShieldItem(){
    if(userData.shield < 1 || activeShield){
        showToast(activeShield ? "æŠ¤ç›¾å·²ç”Ÿæ•ˆ" : "æŠ¤ç›¾æ•°é‡ä¸è¶³");
        return;
    }
    userData.shield--;
    activeShield = true;
    saveUserData();
    updateItemBtnUI();
    createPlayer();
    showToast("æŠ¤ç›¾å·²æ¿€æ´»ï¼ŒæŠµæŒ¡1æ¬¡ç¢°æ’ï¼");
}
function useDoubleItem(){
    if(userData.double < 1 || doubleActive){
        showToast(doubleActive ? "åŒå€å·²ç”Ÿæ•ˆ" : "åŒå€æ•°é‡ä¸è¶³");
        return;
    }
    userData.double--;
    doubleActive = true;
    saveUserData();
    updateItemBtnUI();
    showToast("åŒå€å¾—åˆ†å¼€å¯ï¼Œ10ç§’Ã—2ï¼");
    clearTimeout(doubleTimer);
    doubleTimer = setTimeout(()=>{
        doubleActive = false;
        showToast("åŒå€å¾—åˆ†ç»“æŸ");
    },10000);
}

// AIå¯¹è¯
function showAIChat(){
    hideAll();
    aiChatPanel.style.display = 'flex';
    updateAllDataDisplay();
}
function hideAIChat(){
    aiChatPanel.style.display = 'none';
    showMainMenu();
}
async function sendChat(){
    let msg = chatInput.value.trim();
    if(!msg){ showToast("è¯·è¾“å…¥é—®é¢˜"); return; }
    if(userData.gold < 5){ showToast("é‡‘å¸ä¸è¶³ï¼Œéœ€è¦5é‡‘å¸"); return; }
    
    userData.gold -=5;
    saveUserData();
    updateAllDataDisplay();
    let userDiv = document.createElement('div');
    userDiv.className = 'chat-message user-msg';
    userDiv.innerText = msg;
    chatBox.appendChild(userDiv);
    chatInput.value = '';
    chatBox.scrollTop = chatBox.scrollHeight;
    try{
        let res = await fetch("https://api.deepseek.com/v1/chat/completions",{
            method:"POST",
            headers:{
                "Content-Type":"application/json",
                "Authorization":"Bearer sk-32ffb4a7802c469ab5c60a44993d95bd"
            },
            body:JSON.stringify({
                model:"deepseek-chat",
                messages:[{role:"user",content:msg}],
                temperature:0.7
            })
        });
        let data = await res.json();
        let aiMsg = data.choices[0].message.content;
        let aiDiv = document.createElement('div');
        aiDiv.className = 'chat-message ai-msg';
        aiDiv.innerText = aiMsg;
        chatBox.appendChild(aiDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }catch(e){
        showToast("AIè¯·æ±‚å¤±è´¥");
        userData.gold +=5;
        saveUserData();
        updateAllDataDisplay();
    }
}

// è®¾ç½®åŠŸèƒ½
function showSettingsPanel(){
    settingsPanel.style.display='block';
    effectSwitch.className=settings.effectsEnabled?'switch active':'switch';
    vibrationSwitch.className=settings.vibrationEnabled?'switch active':'switch';
}
function hideSettingsPanel(){settingsPanel.style.display='none'}
function toggleEffect(){
    settings.effectsEnabled=!settings.effectsEnabled;
    effectSwitch.className=settings.effectsEnabled?'switch active':'switch';
    showToast(`ç‰¹æ•ˆå·²${settings.effectsEnabled?'å¼€å¯':'å…³é—­'}`);
}
function toggleVibration(){
    settings.vibrationEnabled=!settings.vibrationEnabled;
    vibrationSwitch.className=settings.vibrationEnabled?'switch active':'switch';
    showToast(`éœ‡åŠ¨å·²${settings.vibrationEnabled?'å¼€å¯':'å…³é—­'}`);
}
function confirmReset(){
    if(!confirm('ç¡®å®šæ³¨é”€ï¼Ÿæ‰€æœ‰çš®è‚¤ã€é“å…·ã€é‡‘å¸æ¸…ç©ºï¼')) return;
    userData = {gold:0,totalScore:0,ownedSkins:[1],currentSkinId:1,shield:0,double:0};
    skins.forEach(s=>{s.owned = s.id === 1;});
    currentSkin = skins.find(s=>s.id===1);
    activeShield = false; doubleActive = false; clearTimeout(doubleTimer);
    localStorage.removeItem('ballGameSave');
    updateAllDataDisplay();
    renderSkinList();
    showToast('æ‰€æœ‰è¿›åº¦å·²é‡ç½®ï¼');
    hideSettingsPanel();
}

// åŸºç¡€åŠŸèƒ½
function init(){
    try{
        let s=localStorage.getItem('ballGameSave');
        if(s){
            let d=JSON.parse(s);
            userData={
                gold:safeNumber(d.gold,0),totalScore:safeNumber(d.totalScore,0),
                ownedSkins:Array.isArray(d.ownedSkins)?d.ownedSkins:[1],currentSkinId:safeNumber(d.currentSkinId,1),
                shield:safeNumber(d.shield,0),double:safeNumber(d.double,0)
            };
            if(!userData.ownedSkins.includes(1)) userData.ownedSkins.push(1);
            skins.forEach(sk=>sk.owned=userData.ownedSkins.includes(sk.id));
            let sk=skins.find(x=>x.id===userData.currentSkinId);
            currentSkin=sk||skins.find(x=>x.id===1);
        }
    }catch(e){
        userData = {gold:0,totalScore:0,ownedSkins:[1],currentSkinId:1,shield:0,double:0};
        localStorage.removeItem('ballGameSave');
    }
    updateAllDataDisplay();
    renderSkinList();
    initExchangeInput();
}
function showToast(t,d=2000){
    toast.innerText=t;toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'),d);
}
function updateAllDataDisplay(){
    let g=safeNumber(userData.gold),s=safeNumber(userData.totalScore);
    document.querySelectorAll('#mainGold,#diffGold,#exchangeGold,#skinGold,#itemGold,#currentGoldShow').forEach(e=>e.innerText=g);
    document.querySelectorAll('#mainScore,#diffScore,#exchangeScore,#totalScoreShow').forEach(e=>e.innerText=s);
    document.getElementById('maxExchange').innerText=Math.floor(s/5);
    updateItemBtnUI();
}
function initExchangeInput(){
    let e=document.getElementById('exchangeNum'),n=document.getElementById('needScore');
    e.addEventListener('input',()=>{
        let num=Math.max(1,safeNumber(e.value,1));
        e.value=num;n.innerText=num*5;
    });
}
function exchangeGold(){
    let num=safeNumber(document.getElementById('exchangeNum').value),need=num*5,s=safeNumber(userData.totalScore);
    if(num<1)return showToast('è¾“å…¥æœ‰æ•ˆæ•°é‡');
    if(need>s)return showToast('å¾—åˆ†ä¸è¶³');
    userData.totalScore=s-need;userData.gold+=num;saveUserData();updateAllDataDisplay();
    showToast(`è·å¾—${num}é‡‘å¸`);
}
function exchangeMax(){
    let s=safeNumber(userData.totalScore),max=Math.floor(s/5);
    if(max<1)return showToast('æ— å¯å…‘æ¢');
    userData.totalScore-=max*5;userData.gold+=max;saveUserData();updateAllDataDisplay();
    showToast(`å…‘æ¢${max}é‡‘å¸`);
}
function renderSkinList(){
    let l=document.getElementById('skinList'),g=safeNumber(userData.gold);
    l.innerHTML='';
    skins.forEach(sk=>{
        let act=currentSkin.id===sk.id;
        let div=document.createElement('div');
        div.className=`skin-item ${act?'active':''}`;
        div.innerHTML=`<div class="skin-preview" style="background:radial-gradient(circle,${sk.color2},${sk.color});box-shadow:0 0 15px ${sk.color}"></div><div class="skin-name">${sk.name}</div>`;
        let btn=document.createElement('button');btn.className='skin-btn';
        if(sk.owned){
            btn.innerText=act?'ä½¿ç”¨ä¸­':'ä½¿ç”¨';
            btn.style.background=act?'#0ff':'#333';
            btn.onclick=()=>useSkin(sk);
        }else{
            btn.innerText=`${sk.price}é‡‘å¸å…‘æ¢`;
            btn.style.background='#ffd700';
            btn.disabled=g<sk.price;
            btn.onclick=()=>buySkin(sk);
        }
        div.appendChild(btn);l.appendChild(div);
    });
}
function buySkin(sk){
    let g=safeNumber(userData.gold);
    if(sk.owned)return showToast('å·²æ‹¥æœ‰');
    if(g<sk.price)return showToast(`è¿˜å·®${sk.price-g}é‡‘å¸`);
    userData.gold=g-sk.price;sk.owned=true;userData.ownedSkins.push(sk.id);
    saveUserData();updateAllDataDisplay();renderSkinList();showToast(`è´­ä¹°${sk.name}æˆåŠŸ`);
}
function useSkin(sk){
    if(!sk.owned)return showToast('è¯·å…ˆå…‘æ¢');
    currentSkin=sk;userData.currentSkinId=sk.id;saveUserData();renderSkinList();showToast(`ä½¿ç”¨${sk.name}`);
}
function saveUserData(){localStorage.setItem('ballGameSave',JSON.stringify(userData))}
function showItemMenu(){hideAll();itemMenu.style.display='flex';updateAllDataDisplay()}
function buyItem(type){
    let price, name;
    if(type==='shield'){price=30;name='æŠ¤ç›¾'}
    if(type==='double'){price=50;name='åŒå€å¾—åˆ†'}
    if(userData.gold < price){showToast(`é‡‘å¸ä¸è¶³ï¼Œéœ€${price}é‡‘å¸`);return;}
    userData.gold -= price;
    type==='shield'?userData.shield++:userData.double++;
    saveUserData();updateAllDataDisplay();showToast(`è´­ä¹°${name}æˆåŠŸï¼`);
}

// é¡µé¢åˆ‡æ¢
function showMainMenu(){hideAll();mainMenu.style.display='flex';resetGame();updateAllDataDisplay()}
function showDifficultyMenu(){hideAll();difficultyMenu.style.display='flex';updateAllDataDisplay()}
function showExchangeMenu(){hideAll();exchangeMenu.style.display='flex';updateAllDataDisplay()}
function showSkinMenu(){hideAll();skinMenu.style.display='flex';updateAllDataDisplay();renderSkinList()}
function showGame(){hideAll();gameUI.style.display='block';updateAllDataDisplay()}
function showPauseMenu(){playing=false;pauseMenu.style.display='block'}
function showGameOverMenu(){playing=false;gameOverMenu.style.display='block'}
function hideAll(){
    mainMenu.style.display=difficultyMenu.style.display=exchangeMenu.style.display=skinMenu.style.display=itemMenu.style.display='none';
    gameUI.style.display=pauseMenu.style.display=gameOverMenu.style.display=settingsPanel.style.display=aiChatPanel.style.display=superDevPanel.style.display='none';
}

// ä¿®å¤ï¼šç‚¹é“å…·å°çƒç»å¯¹ä¸ç§»åŠ¨
window.addEventListener('mousemove',e=>{
    if(gameUI.style.display === 'block' && playing &&
       !['shieldUseBtn','doubleUseBtn','pauseBtn'].includes(e.target.id)){
        px = e.x; py = e.y;
    }
});
window.addEventListener('touchmove',e=>{
    e.preventDefault();
    if(gameUI.style.display === 'block' && playing &&
       !['shieldUseBtn','doubleUseBtn','pauseBtn'].includes(e.target.id)){
        px = e.touches[0].clientX; py = e.touches[0].clientY;
    }
});

// ä¿®å¤å°çƒæ°¸ä¸æ¶ˆå¤±
function createPlayer() {
    if (player) player.remove();
    player = document.createElement('div');
    player.id = 'player';
    settings.effectsEnabled && player.classList.add('pulse');
    player.style.background = `radial-gradient(circle,${currentSkin.color2},${currentSkin.color})`;
    player.style.boxShadow = activeShield ?
        `0 0 30px #ffd700,0 0 60px #ffd700` :
        (settings.effectsEnabled ? `0 0 30px ${currentSkin.color},0 0 60px ${currentSkin.color2}` : `0 0 10px ${currentSkin.color}`);
    player.style.setProperty('--skin-color', currentSkin.color);
    player.style.setProperty('--skin-color2', currentSkin.color2);
    game.appendChild(player);
    px = w / 2; py = h / 2;
    player.style.left = px + 'px';
    player.style.top = py + 'px';
}

function createTrail(x,y){
    if(!settings.effectsEnabled)return;
    let t=document.createElement('div');t.className='trail';
    t.style.left=x+'px';t.style.top=y+'px';t.style.background=currentSkin.color;
    t.style.boxShadow=`0 0 10px ${currentSkin.color}`;game.appendChild(t);
    setTimeout(()=>{t.style.opacity=0;setTimeout(()=>t.remove(),200)},200);
}
function spawnObstacle(){
    if(!playing)return;
    let o=document.createElement('div');o.className='obstacle';
    o.style.width=(Math.random()*200+120)+'px';
    o.style.left=Math.random()*(w-220)+'px';o.style.top='-60px';
    !settings.effectsEnabled && (o.style.boxShadow='none');
    game.appendChild(o);obstacles.push(o);
}

// æ¸¸æˆå¾ªç¯
function update(){
    if(!playing)return;
    player.style.left=px+'px';player.style.top=py+'px';
    settings.effectsEnabled && createTrail(px,py);
    
    for(let i=0;i<obstacles.length;i++){
        let o=obstacles[i],y=parseFloat(o.style.top)+speed;
        o.style.top=y+'px';o.style.transform=`rotate(${rotateSpeed}deg)`;
        
        if(y>h){
            o.remove();obstacles.splice(i,1);i--;
            score += doubleActive ? 2 : 1;
            scoreText.innerText=score;
            speed+=difficultyConfig[currentDifficulty].speedGain;
            rotateSpeed+=difficultyConfig[currentDifficulty].rotateGain;
        }
        
        let pr=player.getBoundingClientRect(),or=o.getBoundingClientRect();
        if(pr.right>or.left+8&&pr.left<or.right-8&&pr.bottom>or.top+8&&pr.top<or.bottom-8){
            if(activeShield || godMode){
                activeShield = false;
                createPlayer();
                o.remove();obstacles.splice(i,1);i--;
                showToast('æŠµæŒ¡ç¢°æ’æˆåŠŸï¼');
                continue;
            }
            settings.vibrationEnabled && navigator.vibrate&&navigator.vibrate(200);
            document.body.classList.add('shake');
            setTimeout(()=>document.body.classList.remove('shake'),400);
            gameOver();return;
        }
    }
    requestAnimationFrame(update);
}

function startGame(d){
    currentDifficulty=d;let c=difficultyConfig[d];resetGame();showGame();
    speed=c.initSpeed;rotateSpeed=0;score=0;scoreText.innerText=score;playing=true;
    createPlayer();spawnTimer=setInterval(spawnObstacle,c.spawnInterval);update();
}
function resumeGame(){pauseMenu.style.display='none';playing=true;update()}
function restartGame(){
    activeShield = false; doubleActive = false; godMode = false; clearTimeout(doubleTimer);
    pauseMenu.style.display='none';gameOverMenu.style.display='none';startGame(currentDifficulty);
}
function gameOver(){
    playing=false;clearInterval(spawnTimer);clearTimeout(doubleTimer);
    userData.totalScore=safeNumber(userData.totalScore+score);saveUserData();updateAllDataDisplay();
    document.getElementById('finalScore').innerText=score;
    showGameOverMenu();
}
function backToMain(){
    activeShield = false; doubleActive = false; godMode = false; clearTimeout(doubleTimer);
    resetGame();showMainMenu();
}
function resetGame(){
    playing=false;clearInterval(spawnTimer);clearTimeout(doubleTimer);
    obstacles.forEach(o=>o.remove());document.querySelectorAll('.trail').forEach(t=>t.remove());
    obstacles=[];score=0;speed=0;rotateSpeed=0;scoreText.innerText=0;
    activeShield = false; doubleActive = false; godMode = false;
}

window.addEventListener('resize',()=>{w=innerWidth;h=innerHeight});
init();
</script>
</body>
</html>
