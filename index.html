<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è´ªåƒè›‡</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;-webkit-tap-highlight-color:transparent}
body{background:#1a1a1a;color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow:hidden}
#container{position:relative;width:100vw;max-width:480px;height:100vh;max-height:800px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px}

/* ä¸»èœå• */
#menu{display:flex;flex-direction:column;align-items:center;gap:14px}
#menu h1{font-size:42px;margin-bottom:6px}
#infoBar{display:flex;gap:20px;margin-bottom:10px}
.infoItem{font-size:18px;color:#ffd700}

.menu-btn{width:230px;height:54px;font-size:19px;border:none;border-radius:12px;background:#4CAF50;color:white}
.menu-btn:active{background:#388E3C}

/* æ¨¡å¼é¡µé¢ */
#modePage{display:none;flex-direction:column;align-items:center;gap:20px}
#modePage h2{font-size:26px}
.mode-btn{width:210px;height:50px;font-size:18px;border:none;border-radius:12px;background:#2196F3;color:white}

/* çš®è‚¤é¡µé¢ */
#skinPage{display:none;flex-direction:column;align-items:center;gap:12px;width:100%}
#skinPage h2{font-size:26px}
#skinGold{font-size:17px;color:#ffd700;margin-bottom:4px}
#skinMsg{font-size:15px;color:#ff4444;height:18px}

.skin-list{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;max-width:320px}
.skin-item{width:52px;height:52px;border-radius:8px;border:3px solid #444;position:relative}
.skin-item.active{border-color:#fff}
.skin-item.locked{filter:grayscale(1);opacity:0.5}
.skin-item.unlocked{filter:none;opacity:1}
.lock{position:absolute;bottom:2px;right:2px;font-size:12px;color:#ffd700}

#buyBtn{width:170px;height:46px;font-size:17px;background:#ff9800;color:white;border:none;border-radius:12px}
#backBtn{width:170px;height:44px;font-size:16px;background:#666;color:white;border:none;border-radius:12px;margin-top:4px}

/* æ¸¸æˆç•Œé¢ */
#gameContainer{display:none;flex-direction:column;align-items:center;width:100%;position:relative}
#score{font-size:22px;margin:10px 0}
canvas{border:3px solid #fff;background:#000;width:90%;aspect-ratio:1/1}

#homeBtn{position:absolute;top:10px;left:10px;width:42px;height:42px;background:white;border-radius:8px;font-size:20px;border:none}

#controls{display:grid;grid-template:". up ." "left down right";gap:10px;margin-top:16px}
#controls button{width:68px;height:68px;font-size:26px;border:none;border-radius:14px;background:#444;color:white}
#controls button:active{background:#666}

/* å¼¹çª— */
.popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#222;padding:26px;border-radius:14px;border:2px solid #fff;text-align:center;display:none}
.popup button{margin:6px;padding:8px 16px;font-size:15px;border:none;border-radius:8px;background:#4CAF50;color:white}
</style>
</head>
<body>

<div id="container">
  <!-- ä¸»èœå• -->
  <div id="menu">
    <h1>è´ªåƒè›‡</h1>
    <div id="infoBar">
      <div class="infoItem">æ€»åˆ†ï¼š<span id="totalScore">0</span></div>
      <div class="infoItem">é‡‘å¸ï¼š<span id="totalGold">0</span></div>
    </div>
    <button class="menu-btn" onclick="showModePage()">é€‰æ‹©æ¨¡å¼</button>
    <button class="menu-btn" onclick="showSkinPage()">æ›´æ¢çš®è‚¤</button>
    <button class="menu-btn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
  </div>

  <!-- æ¨¡å¼ -->
  <div id="modePage">
    <h2>é€‰æ‹©éš¾åº¦</h2>
    <button class="mode-btn" onclick="setMode(180)">ç®€å•ï¼ˆæ…¢ï¼‰</button>
    <button class="mode-btn" onclick="setMode(120)">æ™®é€šï¼ˆä¸­ï¼‰</button>
    <button class="mode-btn" onclick="setMode(70)">å›°éš¾ï¼ˆå¿«ï¼‰</button>
  </div>

  <!-- çš®è‚¤ -->
  <div id="skinPage">
    <h2>çš®è‚¤å•†åº—</h2>
    <div id="skinGold">å½“å‰é‡‘å¸ï¼š<span id="skinGoldNum">0</span></div>
    <div id="skinMsg"></div>
    <div class="skin-list" id="skinList"></div>
    <button id="buyBtn" onclick="buySkin()">è§£é”çš®è‚¤</button>
    <button id="backBtn" onclick="backToMenu()">è¿”å›ä¸»é¡µ</button>
  </div>

  <!-- æ¸¸æˆ -->
  <div id="gameContainer">
    <button id="homeBtn" onclick="showPause()">ğŸ </button>
    <div id="score">å¾—åˆ†ï¼š0</div>
    <canvas id="game"></canvas>
    <div id="controls">
      <button id="btnUp">â†‘</button>
      <button id="btnLeft">â†</button>
      <button id="btnDown">â†“</button>
      <button id="btnRight">â†’</button>
    </div>
  </div>

  <!-- å¼¹çª— -->
  <div class="popup" id="pausePopup">
    <h2>æ¸¸æˆæš‚åœ</h2>
    <button onclick="continueGame()">ç»§ç»­</button>
    <button onclick="restartGame()">é‡æ–°å¼€å§‹</button>
    <button onclick="backToMenu()">è¿”å›ä¸»é¡µ</button>
  </div>

  <div class="popup" id="overPopup">
    <h2>æ¸¸æˆç»“æŸ</h2>
    <button onclick="restartGame()">å†æ¥ä¸€å±€</button>
    <button onclick="backToMenu()">è¿”å›ä¸»é¡µ</button>
  </div>
</div>

<script>
// æ•°æ®
let totalScore = 0;
let totalGold = 0;
let gameSpeed = 120;
let currentSkin = "#4CAF50";
let selectSkinIndex = 0;

// 6æ¬¾çš®è‚¤ï¼šé¢œè‰²ã€ä»·æ ¼ã€æ˜¯å¦è§£é”
let skins = [
  {color:"#4CAF50", price:0, unlocked:true},
  {color:"#2196F3", price:10, unlocked:false},
  {color:"#FF9800", price:20, unlocked:false},
  {color:"#E91E63", price:30, unlocked:false},
  {color:"#9C27B0", price:40, unlocked:false},
  {color:"#00BCD4", price:50, unlocked:false},
  {color:"#8BC34A", price:60, unlocked:false},
];

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let grid, snake, dx, dy, food, score, gameLoop, isPaused;

// é¡µé¢åˆ‡æ¢
function show(id){
  document.getElementById('menu').style.display='none';
  document.getElementById('modePage').style.display='none';
  document.getElementById('skinPage').style.display='none';
  document.getElementById('gameContainer').style.display='none';
  document.getElementById(id).style.display='flex';
}

function backToMenu(){
  clearInterval(gameLoop);
  document.querySelectorAll('.popup').forEach(p=>p.style.display='none');
  updateMenuInfo();
  show('menu');
}

// æ›´æ–°ä¸»é¡µæ˜¾ç¤º
function updateMenuInfo(){
  document.getElementById('totalScore').innerText = totalScore;
  document.getElementById('totalGold').innerText = totalGold;
}

// æ¨¡å¼
function showModePage(){ show('modePage') }
function setMode(speed){ gameSpeed=speed; show('menu') }

// çš®è‚¤é¡µé¢
function showSkinPage(){
  document.getElementById('skinGoldNum').innerText = totalGold;
  renderSkinList();
  show('skinPage');
}

function renderSkinList(){
  const list = document.getElementById('skinList');
  list.innerHTML = '';
  skins.forEach((s,i)=>{
    const div = document.createElement('div');
    div.className = 'skin-item '+(s.unlocked?'unlocked':'locked')+(i==selectSkinIndex?' active':'');
    div.style.background = s.color;
    div.innerHTML = s.unlocked?'':'<span class="lock">ğŸ”’</span>';
    div.onclick = ()=>{selectSkinIndex=i; renderSkinList()};
    list.appendChild(div);
  });
}

// è§£é”çš®è‚¤
function buySkin(){
  const s = skins[selectSkinIndex];
  const msg = document.getElementById('skinMsg');
  if(s.unlocked){
    currentSkin = s.color;
    msg.innerText = 'å·²åº”ç”¨è¯¥çš®è‚¤';
    return;
  }
  if(totalGold >= s.price){
    totalGold -= s.price;
    s.unlocked = true;
    currentSkin = s.color;
    msg.innerText = 'è§£é”æˆåŠŸï¼';
    document.getElementById('skinGoldNum').innerText = totalGold;
    renderSkinList();
    updateMenuInfo();
  }else{
    msg.innerText = 'é‡‘å¸ä¸è¶³ï¼Œéœ€è¦'+s.price+'é‡‘å¸';
  }
}

// æ¸¸æˆ
function startGame(){
  show('gameContainer');
  initGame();
}

function initGame(){
  snake = [{x:10,y:10}];
  dx=1; dy=0;
  score=0;
  isPaused=false;
  updateScore();
  spawnFood();
  clearInterval(gameLoop);
  gameLoop = setInterval(draw, gameSpeed);
}

function spawnFood(){
  food={x:Math.floor(Math.random()*20), y:Math.floor(Math.random()*20)};
  snake.forEach(s=>{if(s.x==food.x&&s.y==food.y) spawnFood()});
}

function draw(){
  if(isPaused) return;
  ctx.fillStyle='#000';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle=currentSkin;
  snake.forEach(s=>ctx.fillRect(s.x*grid,s.y*grid,grid-2,grid-2));

  ctx.fillStyle='#f00';
  ctx.fillRect(food.x*grid,food.y*grid,grid-2,grid-2);

  const head={x:snake[0].x+dx, y:snake[0].y+dy};

  if(head.x<0||head.x>=20||head.y<0||head.y>=20){gameOver();return}
  for(let s of snake) if(s.x==head.x&&s.y==head.y){gameOver();return}

  snake.unshift(head);

  if(head.x==food.x&&head.y==food.y){
    score+=10;
    updateScore();
    spawnFood();
  }else{
    snake.pop();
  }
}

function updateScore(){
  document.getElementById('score').innerText='å¾—åˆ†ï¼š'+score;
}

function gameOver(){
  clearInterval(gameLoop);
  totalScore += score;
  totalGold += Math.floor(score/10);
  updateMenuInfo();
  document.getElementById('overPopup').style.display='block';
}

// æ–¹å‘æ§åˆ¶
function dir(ndx,ndy){
  if(isPaused)return;
  if(dx==-ndx&&dy==-ndy)return;
  dx=ndx; dy=ndy;
}
document.getElementById('btnUp').onclick=()=>dir(0,-1);
document.getElementById('btnDown').onclick=()=>dir(0,1);
document.getElementById('btnLeft').onclick=()=>dir(-1,0);
document.getElementById('btnRight').onclick=()=>dir(1,0);

document.addEventListener('keydown',e=>{
  if(isPaused)return;
  if(e.key=='ArrowLeft'&&dx!=1)dir(-1,0);
  if(e.key=='ArrowUp'&&dy!=1)dir(0,-1);
  if(e.key=='ArrowRight'&&dx!=-1)dir(1,0);
  if(e.key=='ArrowDown'&&dy!=-1)dir(0,1);
});

// æš‚åœ
function showPause(){isPaused=true; document.getElementById('pausePopup').style.display='block'}
function continueGame(){isPaused=false; document.getElementById('pausePopup').style.display='none'}
function restartGame(){
  clearInterval(gameLoop);
  document.querySelectorAll('.popup').forEach(p=>p.style.display='none');
  initGame();
}

// è‡ªé€‚åº”
function resize(){
  const size=Math.min(window.innerWidth*0.9,400);
  canvas.width=size; canvas.height=size;
  grid=size/20;
}
window.addEventListener('resize',resize);
resize();
updateMenuInfo();
</script>
</body>
</html>
